\documentclass[../DD0.tex]{subfiles}

\newcommand{\tracMatrix}[3] {
  \begin{table}[h!]
    \centering
    \begin{tabularx}{\linewidth}{|c|X|X|}
      \hline
      \textbf{Requirement} & \textbf{Description} & \textbf{Components} \\
      #3
      \hline
    \end{tabularx}
    %\caption{#1}
    \label{tab:#2}
  \end{table}
}

\newcommand{\tracRow}[3] {
  \hline \texttt{R.#1} & #2 & #3 \\
}

\begin{document}

\section{Requirements Traceability}
\label{sec:req}

  In the following tables we present the mapping between the requirements defined in the RASD document and the system components of Section~\ref{sec:compview}\footnote{In this section, for readibility purposes, we give a brief description of the requirements. For the full definition see Secrion 3.2 of RASD document}.

  \subsection{Account handling}

    \tracMatrix{}{accounthandling}{
      \tracRow{A1}{Registration as user}{\AccountManager, Database}
      \tracRow{A2}{Registration as third party}{\AccountManager, Database}
      \tracRow{A3}{Distinguish user and third party accounts}{\AccountManager}
      \tracRow{A4}{Account uniqueness}{\AccountManager, Database}
      \tracRow{A5}{Account login}{\AccountManager, Database}
      \tracRow{A6}{Only authenticated accounts can exploit functionalities}{\AccountManager, Database}
    }

  \subsection{Data encoding}

    \tracMatrix{}{dataencoding}{
      \tracRow{D1}{Encode and store data}{\DataCollector, Database}
      \tracRow{D2}{Retrive data}{\SetBuilder, \FilterManager, Database}
      \tracRow{D3}{Not erase stored data}{Database}
      \tracRow{D4}{Data property}{\AccountManager, \DataCollector, Database}
      \tracRow{D5}{Share data among multiple accounts}{\AccountManager, Database}
      \tracRow{D6}{Compone data sets}{\SetBuilder, \FilterManager, Database}
    }

  \clearpage
  \subsection{Interfaces}

    \tracMatrix{}{tracinterfaces}{
      \tracRow{I1}{Registration form}{Application, \AccountManager}
      \tracRow{I2}{Render data graphically}{Application}
      \tracRow{I3}{Third parties' request form}{Application, \RequestManager}
    }

  \subsection{Data sharing requests}

    \tracMatrix{}{datasharingrequests}{
      \tracRow{R1}{Single user request form}{\RequestManager}
      \tracRow{R2}{Notify requests to users}{Application, \AccountManager, \RequestManager}
      \tracRow{R3}{Notify deny to third parties}{Application, \AccountManager, \RequestManager}
      \tracRow{R4}{Anonymous group request form}{\RequestManager}
      \tracRow{R5}{Check anonymity}{\RequestManager, \SetBuilder}
      \tracRow{R6}{Grant access to anonymous data}{\RequestManager, Database}
      \tracRow{R7}{}{} % TODO correct this
    }

  %\clearpage
  \subsection{SOS calls}

    \tracMatrix{}{tracsoscalls}{
      \tracRow{S1}{Apply to \texttt{AutomatedSOS}}{\AccountManager}
      \tracRow{S2}{Monitor parameters}{\EmergencyDetector}
      \tracRow{S3}{Send emergency message}{\EmergencyDispatcher, SOSSystem}
      \tracRow{S4}{Build emergency message}{\EmergencyDispatcher}
    }

  \clearpage
  \subsection{Payment}

    \tracMatrix{}{tracpayment}{
      \tracRow{M1}{Third parties shall pay}{\AccountManager, \PaymentGateway, PaymentSystem}
    }

\end{document}
